<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Trang chủ</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
  <div class="container">
    <img id="background" src="1.jpg" alt="Hình nền cố định">
    <div class="upload-section">
      <div class="upload-buttons">
        <input type="file" id="imageUpload" hidden>
        <button id="changeBackground">CHỌN HÌNH NỀN MỚI</button>
        <input type="file" id="newBackgroundImage" style="display: none;">
        <label for="imageUpload" class="upload-button">CHỌN ẢNH</label>
        <button class="upload-submit" onclick="handleUpload()">UPLOAD</button>
      </div>
      <div class="selected-image">
        <span class="path">Chưa chọn ảnh</span>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    const API_NAME = "Ecodemo";
    const API_KEY = "JuKtutHEqvgyqiChAv6ya62r";
    async function handleUpload()
    {
      const fileInput = document.getElementById('imageUpload');
      const uploadButton = document.querySelector('.upload-submit');
      const backgroundImage = document.getElementById("background");

      uploadButton.disabled = true;
      uploadButton.textContent = 'Đang xử lý...';

      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append('size', 'auto');
      formData.append('image_file', file);

      try
      {
        const response = await fetch('https://api.remove.bg/v1.0/removebg', {
          method: 'POST',
          headers: {
            'X-Api-Key': API_KEY
          },
          body: formData
        });


        const processedImageURL = URL.createObjectURL(await response.blob());
        const processedImage = new Image();

        processedImage.onload = function ()
        {

          var processedImageWidth = backgroundImage.width / 4;
          var processedImageHeight = (processedImageWidth / processedImage.width) * processedImage.height;
          var processedImageX = backgroundImage.width / 2 + (backgroundImage.width / 2 - processedImageWidth) / 2;
          var processedImageY = (backgroundImage.height - processedImageHeight) / 2;

          const canvas = document.createElement('canvas');
          canvas.width = backgroundImage.naturalWidth;
          canvas.height = backgroundImage.naturalHeight;

          const ctx = canvas.getContext('2d');
          ctx.drawImage(backgroundImage, 0, 0);
          ctx.drawImage(processedImage, processedImageX, processedImageY, processedImageWidth, processedImageHeight);

          backgroundImage.src = canvas.toDataURL('image/jpeg');

          URL.revokeObjectURL(processedImageURL);

          uploadButton.disabled = false;
          uploadButton.textContent = 'UPLOAD';
        };

        processedImage.src = processedImageURL;

        uploadButton.disabled = false;
        uploadButton.textContent = 'UPLOAD';
      } catch (error)
      {
        console.error(error);

        uploadButton.disabled = false;
        uploadButton.textContent = 'UPLOAD';
      }
    }

    const button = document.getElementById('changeBackground');
    const fileInput = document.getElementById('newBackgroundImage');

    button.addEventListener('click', function ()
    {
      fileInput.click();
    });

    fileInput.addEventListener('change', function ()
    {
      const file = this.files[0];
      const reader = new FileReader();

      reader.onload = function (e)
      {
        const backgroundImage = document.getElementById("background");
        backgroundImage.src = e.target.result;
      }

      reader.readAsDataURL(file);
    });
  </script>
</body>

</html>